<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/toggleForm.js" defer></script>
  </head>
  <body>
    <%- include('navbar') %> <% if (locals.user) { %>
    <h1>Welcome <%= user.first_name + ' ' + user.last_name %></h1>
    <% } %>

    <ul>
      <% messages.forEach((message) => { %>
      <li>
        <% if(locals.user.is_admin) { %>

        <span class="delete-btn" data-id="<%= message.id %>">&times;</span>
        <%}%>
        <div>
          <% if (locals.user && user.membership_status) { %> <%=
          message.first_name + ' ' + message.last_name %> <% } else { %>
          Anonymous <% } %>
        </div>

        <div>
          <% if (locals.user && user.membership_status) { %> <%=
          message.timestamp %> <% } else { %> YYYY-MM-DD XX:XX <% } %>
        </div>

        <div><%= message.title %></div>
        <div><%= message.text %></div>
      </li>
      <% }) %>
    </ul>

    <div id="postMessageModal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <form action="/create-message" method="POST">
          <h2>New message</h2>
          <div class="add-trainer-input-container">
            <label for="title">Title:</label>
            <input
              type="text"
              id="title"
              name="title"
              minlength="1"
              maxlength="50"
              required
            />
          </div>

          <div>
            <label for="text">Text:</label>
            <input
              type="text"
              id="text"
              name="text"
              minlength="1"
              maxlength="128"
              placeholder="What's on your mind?"
              required
            />
          </div>

          <button class="submit-btn" type="submit">Post</button>
        </form>
      </div>
    </div>

    <% if(locals.user.is_admin) { %>
    <div id="deleteConfirmationModal" class="modal">
      <div class="modal-content">
        <h2>Are you sure you want to delete this message?</h2>
        <div class="modal-buttons">
          <button id="confirmDeleteBtn">OK</button>
          <button id="cancelBtn">Cancel</button>
        </div>
      </div>
    </div>
    <% } %> <%- include('footer') %>
  </body>
</html>
